{% extends 'base.html' %}
{% block content %}
{% load static %}
<div class="after-game">
  <h1 style="font-family: 'Press Start 2P';font-size: 200%;color: darkorange;margin-bottom: 1%;">Your Score is</h1>
  {% if stage == 3 %}
    <div class="result-flip">
      <div class="result-card">
        <div class="result-front" >
          <h1 style="font-size:600%;" class="your-score">Perfect!!</h1>
        </div>
        <div class="result-back">
          <input type="text">
        </div>
      </div>
    </div>
  {% else %}
    <h1 style="font-size:600%;" class="your-score">Perfect!!</h1>
  {% endif %}
  <p style="font-family: 'Noto Sans KR', sans-serif;position: relative;top:-1%;" id="result-words"></p>
  <div class="after_game_slide after_game_slide_wrap">
  {% for mv in movielist %}
    <div class="after_game_slide_item item1">
      <img id="recommend-poster" src={{ mv.movie.poster_path }} alt="">
      <div id="recommend-information">
        <h2 id="recommend-title">{{ mv.movie.title }}</h2>
        <p style="margin-bottom:1%;margin-top:2%;position: absolute;top:15%;" >ì¸ê¸°ë„: {{ mv.movie.popularity }}ì </p>
        <h4 style="margin-bottom:1%;margin-top:2%;position: absolute;top:30%;" >ğŸ“ë² ìŠ¤íŠ¸ ë¦¬ë·°ğŸ‘</h4>
        <p id="recommend-review">{{ mv.review }}</p>
        <a href="https://movie.naver.com/movie/bi/mi/basic.naver?code={{ mv.movie.link }}">
          <img src={% static 'image/naver.png' %} alt="naver.icon">
        </a>
      </div>
    </div>
    {% endfor %}
    <div class="slide_prev_button after_game_slide_button">â—€</div>
    <div class="slide_next_button after_game_slide_button">â–¶</div>
    <ul class="slide_pagination"></ul>
  </div>
</div>
{% endblock content %}

{% block script %}
  <script>
    const words = document.getElementById("result-words");
    words.innerText = "ğŸ¥³ë‹¹ì‹ ì€ ì˜í™”ì˜ ì‹ ì¸ê°€ìš”?!ğŸ‰"

    // ìŠ¬ë¼ì´í¬ ì „ì²´ í¬ê¸°(width êµ¬í•˜ê¸°)
    const slide = document.querySelector(".after_game_slide");
    let slideWidth = 704;
    // console.log(slideWidth);

    // ë²„íŠ¼ ì—˜ë¦¬ë¨¼íŠ¸ ì„ íƒí•˜ê¸°
    const prevBtn = document.querySelector(".slide_prev_button");
    const nextBtn = document.querySelector(".slide_next_button");

    // ìŠ¬ë¼ì´ë“œ ì „ì²´ë¥¼ ì„ íƒí•´ ê°’ì„ ë³€ê²½í•´ì£¼ê¸° ìœ„í•´ ìŠ¬ë¼ì´ë“œ ì „ì²´ ì„ íƒí•˜ê¸°
    let slideItems = document.querySelectorAll(".after_game_slide_item");
    // í˜„ì¬ ìŠ¬ë¼ì´ë“œ ìœ„ì¹˜ê°€ ìŠ¬ë¼ì´ë“œ ê°œìˆ˜ë¥¼ ë„˜ê¸°ì§€ ì•Šê²Œ í•˜ê¸° ìœ„í•œ ë³€ìˆ˜
    const maxSlide = slideItems.length;

    // ë²„íŠ¼ í´ë¦­í•  ë•Œ ë§ˆë‹¤ í˜„ì¬ ìŠ¬ë¼ì´ë“œê°€ ì–´ë””ì¸ì§€ ì•Œë ¤ì£¼ê¸° ìœ„í•œ ë³€ìˆ˜
    let currSlide = 1;

    // í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„±
    const pagination = document.querySelector(".slide_pagination");

    for (let i = 0; i < maxSlide; i++) {
      if (i === 0) pagination.innerHTML += `<li class="active">â€¢</li>`;
      else pagination.innerHTML += `<li>â€¢</li>`;
    }

    const paginationItems = document.querySelectorAll(".slide_pagination > li");

    // ë¬´í•œ ìŠ¬ë¼ì´ë“œë¥¼ ìœ„í•´ start, end ìŠ¬ë¼ì´ë“œ ë³µì‚¬í•˜ê¸°
    const startSlide = slideItems[0];
    const endSlide = slideItems[slideItems.length - 1];
    const startElem = document.createElement("div");
    const endElem = document.createElement("div");

    endSlide.classList.forEach((c) => endElem.classList.add(c));
    endElem.innerHTML = endSlide.innerHTML;

    startSlide.classList.forEach((c) => startElem.classList.add(c));
    startElem.innerHTML = startSlide.innerHTML;

    // ê° ë³µì œí•œ ì—˜ë¦¬ë¨¼íŠ¸ ì¶”ê°€í•˜ê¸°
    slideItems[0].before(endElem);
    slideItems[slideItems.length - 1].after(startElem);

    // ìŠ¬ë¼ì´ë“œ ì „ì²´ë¥¼ ì„ íƒí•´ ê°’ì„ ë³€ê²½í•´ì£¼ê¸° ìœ„í•´ ìŠ¬ë¼ì´ë“œ ì „ì²´ ì„ íƒí•˜ê¸°
    slideItems = document.querySelectorAll(".after_game_slide_item");
    //
    let offset = slideWidth + currSlide;
    slideItems.forEach((i) => {
      i.setAttribute("style", `left: ${-offset}px`);
    });

    function nextMove() {
      currSlide++;
      // ë§ˆì§€ë§‰ ìŠ¬ë¼ì´ë“œ ì´ìƒìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ì•Šê²Œ í•˜ê¸° ìœ„í•´ì„œ
      if (currSlide <= maxSlide) {
        // ìŠ¬ë¼ì´ë“œë¥¼ ì´ë™ì‹œí‚¤ê¸° ìœ„í•œ offset ê³„ì‚°
        const offset = slideWidth * currSlide;
        // ê° ìŠ¬ë¼ì´ë“œ ì•„ì´í…œì˜ leftì— offset ì ìš©
        slideItems.forEach((i) => {
          i.setAttribute("style", `left: ${-offset}px`);
        });
        // ìŠ¬ë¼ì´ë“œ ì´ë™ ì‹œ í˜„ì¬ í™œì„±í™”ëœ pagination ë³€ê²½
        paginationItems.forEach((i) => i.classList.remove("active"));
        paginationItems[currSlide - 1].classList.add("active");
      } else {
        // ë¬´í•œ ìŠ¬ë¼ì´ë“œ ê¸°ëŠ¥ - currSlide ê°’ë§Œ ë³€ê²½í•´ì¤˜ë„ ë˜ì§€ë§Œ ì‹œê°ì ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ í•˜ê¸° ìœ„í•´ ì•„ë˜ ì½”ë“œ ì‘ì„±
        currSlide = 0;
        let offset = slideWidth * currSlide;
        slideItems.forEach((i) => {
          i.setAttribute("style", `transition: ${0}s; left: ${-offset}px`);
        });
        currSlide++;
        offset = slideWidth * currSlide;
        // ê° ìŠ¬ë¼ì´ë“œ ì•„ì´í…œì˜ leftì— offset ì ìš©
        setTimeout(() => {
          // ê° ìŠ¬ë¼ì´ë“œ ì•„ì´í…œì˜ leftì— offset ì ìš©
          slideItems.forEach((i) => {
            // i.setAttribute("style", `transition: ${0}s; left: ${-offset}px`);
            i.setAttribute("style", `transition: ${0.15}s; left: ${-offset}px`);
          });
        }, 0);
        // // ìŠ¬ë¼ì´ë“œ ì´ë™ ì‹œ í˜„ì¬ í™œì„±í™”ëœ pagination ë³€ê²½
        paginationItems.forEach((i) => i.classList.remove("active"));
        paginationItems[currSlide - 1].classList.add("active");
      }
    }
    function prevMove() {
      currSlide--;
      // 1ë²ˆì§¸ ìŠ¬ë¼ì´ë“œ ì´í•˜ë¡œ ë„˜ì–´ê°€ì§€ ì•Šê²Œ í•˜ê¸° ìœ„í•´ì„œ
      if (currSlide > 0) {
        // ìŠ¬ë¼ì´ë“œë¥¼ ì´ë™ì‹œí‚¤ê¸° ìœ„í•œ offset ê³„ì‚°
        const offset = slideWidth * currSlide;
        // ê° ìŠ¬ë¼ì´ë“œ ì•„ì´í…œì˜ leftì— offset ì ìš©
        slideItems.forEach((i) => {
          i.setAttribute("style", `left: ${-offset}px`);
        });
        // ìŠ¬ë¼ì´ë“œ ì´ë™ ì‹œ í˜„ì¬ í™œì„±í™”ëœ pagination ë³€ê²½
        paginationItems.forEach((i) => i.classList.remove("active"));
        paginationItems[currSlide - 1].classList.add("active");
      } else {
        // ë¬´í•œ ìŠ¬ë¼ì´ë“œ ê¸°ëŠ¥ - currSlide ê°’ë§Œ ë³€ê²½í•´ì¤˜ë„ ë˜ì§€ë§Œ ì‹œê°ì ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ í•˜ê¸° ìœ„í•´ ì•„ë˜ ì½”ë“œ ì‘ì„±
        currSlide = maxSlide + 1;
        let offset = slideWidth * currSlide;
        // ê° ìŠ¬ë¼ì´ë“œ ì•„ì´í…œì˜ leftì— offset ì ìš©
        slideItems.forEach((i) => {
          i.setAttribute("style", `transition: ${0}s; left: ${-offset}px`);
        });
        currSlide--;
        offset = slideWidth * currSlide;
        setTimeout(() => {
          // ê° ìŠ¬ë¼ì´ë“œ ì•„ì´í…œì˜ leftì— offset ì ìš©
          slideItems.forEach((i) => {
            // i.setAttribute("style", `transition: ${0}s; left: ${-offset}px`);
            i.setAttribute("style", `transition: ${0.15}s; left: ${-offset}px`);
          });
        }, 0);
        // ìŠ¬ë¼ì´ë“œ ì´ë™ ì‹œ í˜„ì¬ í™œì„±í™”ëœ pagination ë³€ê²½
        paginationItems.forEach((i) => i.classList.remove("active"));
        paginationItems[currSlide - 1].classList.add("active");
      }
    }

    // ë²„íŠ¼ ì—˜ë¦¬ë¨¼íŠ¸ì— í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€í•˜ê¸°
    nextBtn.addEventListener("click", () => {
      // ì´í›„ ë²„íŠ¼ ëˆ„ë¥¼ ê²½ìš° í˜„ì¬ ìŠ¬ë¼ì´ë“œë¥¼ ë³€ê²½
      nextMove();
    });
    // ë²„íŠ¼ ì—˜ë¦¬ë¨¼íŠ¸ì— í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€í•˜ê¸°
    prevBtn.addEventListener("click", () => {
      // ì´ì „ ë²„íŠ¼ ëˆ„ë¥¼ ê²½ìš° í˜„ì¬ ìŠ¬ë¼ì´ë“œë¥¼ ë³€ê²½
      prevMove();
    });

    // ë¸Œë¼ìš°ì € í™”ë©´ì´ ì¡°ì •ë  ë•Œ ë§ˆë‹¤ slideWidthë¥¼ ë³€ê²½í•˜ê¸° ìœ„í•´
    window.addEventListener("resize", () => {
      slideWidth = slide.clientWidth;
    });

    // ê° í˜ì´ì§€ë„¤ì´ì…˜ í´ë¦­ ì‹œ í•´ë‹¹ ìŠ¬ë¼ì´ë“œë¡œ ì´ë™í•˜ê¸°
    for (let i = 0; i < maxSlide; i++) {
      // ê° í˜ì´ì§€ë„¤ì´ì…˜ë§ˆë‹¤ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€í•˜ê¸°
      paginationItems[i].addEventListener("click", () => {
        // í´ë¦­í•œ í˜ì´ì§€ë„¤ì´ì…˜ì— ë”°ë¼ í˜„ì¬ ìŠ¬ë¼ì´ë“œ ë³€ê²½í•´ì£¼ê¸°(currSlideëŠ” ì‹œì‘ ìœ„ì¹˜ê°€ 1ì´ê¸° ë•Œë¬¸ì— + 1)
        currSlide = i + 1;
        // ìŠ¬ë¼ì´ë“œë¥¼ ì´ë™ì‹œí‚¤ê¸° ìœ„í•œ offset ê³„ì‚°
        const offset = slideWidth * currSlide;
        // ê° ìŠ¬ë¼ì´ë“œ ì•„ì´í…œì˜ leftì— offset ì ìš©
        slideItems.forEach((i) => {
          i.setAttribute("style", `left: ${-offset}px`);
        });
        // ìŠ¬ë¼ì´ë“œ ì´ë™ ì‹œ í˜„ì¬ í™œì„±í™”ëœ pagination ë³€ê²½
        paginationItems.forEach((i) => i.classList.remove("active"));
        paginationItems[currSlide - 1].classList.add("active");
      });
    }

    // ë“œë˜ê·¸(ìŠ¤ì™€ì´í”„) ì´ë²¤íŠ¸ë¥¼ ìœ„í•œ ë³€ìˆ˜ ì´ˆê¸°í™”
    let startPoint = 0;
    let endPoint = 0;

    // PC í´ë¦­ ì´ë²¤íŠ¸ (ë“œë˜ê·¸)
    slide.addEventListener("mousedown", (e) => {
      startPoint = e.pageX; // ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ ì‹œì‘ ìœ„ì¹˜ ì €ì¥
    });

    slide.addEventListener("mouseup", (e) => {
      endPoint = e.pageX; // ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ ë ìœ„ì¹˜ ì €ì¥
      if (startPoint < endPoint) {
        // ë§ˆìš°ìŠ¤ê°€ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë“œë˜ê·¸ ëœ ê²½ìš°
        prevMove();
      } else if (startPoint > endPoint) {
        // ë§ˆìš°ìŠ¤ê°€ ì™¼ìª½ìœ¼ë¡œ ë“œë˜ê·¸ ëœ ê²½ìš°
        nextMove();
      }
    });


    // ê¸°ë³¸ì ìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ ë£¨í”„ ì‹œì‘í•˜ê¸°
    let loopInterval = setInterval(() => {
      nextMove();
    }, 3000);

    // ìŠ¬ë¼ì´ë“œì— ë§ˆìš°ìŠ¤ê°€ ì˜¬ë¼ê°„ ê²½ìš° ë£¨í”„ ë©ˆì¶”ê¸°
    slide.addEventListener("mouseover", () => {
      clearInterval(loopInterval);
    });

    // ìŠ¬ë¼ì´ë“œì—ì„œ ë§ˆìš°ìŠ¤ê°€ ë‚˜ì˜¨ ê²½ìš° ë£¨í”„ ì¬ì‹œì‘í•˜ê¸°
    slide.addEventListener("mouseout", () => {
      loopInterval = setInterval(() => {
        nextMove();
      }, 3000);
    });
  </script>
{% endblock script %}